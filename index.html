<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprise Crossword</title>
    <style>
        :root {
            --cell-size: 40px;
            --highlight: #fff9c4; /* Yellow for special words */
            --correct: #c8e6c9;
            --wrong: #ffcdd2;
        }

        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; max-width: 1000px; }
        
        /* Grid Styles */
        #grid { 
            display: grid; 
            grid-template-columns: repeat(15, var(--cell-size)); 
            grid-template-rows: repeat(15, var(--cell-size)); 
            gap: 1px; background: #000; border: 2px solid #000;
        }
        .cell { 
            width: var(--cell-size); height: var(--cell-size); 
            background: white; position: relative; 
        }
        .cell.black { background: #000; }
        .cell input {
            width: 100%; height: 100%; border: none; text-align: center;
            font-size: 18px; font-weight: bold; text-transform: uppercase;
            background: transparent; outline: none;
        }
        .cell.special { background: var(--highlight); }
        .cell.correct { background: var(--correct) !important; }
        .cell.wrong { background: var(--wrong) !important; }
        
        .clue-number {
            position: absolute; top: 1px; left: 2px; font-size: 10px; color: #555;
        }

        /* Sidebar */
        .clues { width: 300px; max-height: 600px; overflow-y: auto; background: white; padding: 15px; border-radius: 8px; }
        .clue-item { cursor: pointer; padding: 4px; border-bottom: 1px solid #eee; }
        .clue-item:hover { background: #f0f0f0; }

        #win-message {
            display: none; margin-top: 20px; padding: 20px;
            background: #4caf50; color: white; border-radius: 8px;
            text-align: center; font-size: 1.2rem; font-weight: bold;
        }

        @media (max-width: 600px) {
            :root { --cell-size: 24px; }
            .clues { width: 100%; }
        }
    </style>
</head>
<body>

    <h1>A Special Puzzle</h1>

    <div class="container">
        <div id="grid"></div>
        <div class="clues">
            <h3>Clues</h3>
            <div><strong>Across</strong><div id="across-clues"></div></div>
            <br>
            <div><strong>Down</strong><div id="down-clues"></div></div>
        </div>
    </div>

    <div id="win-message">
        You win! Weâ€™re going to see Lily Allen in London for a 36 hour whirlwind trip to London on March 21!
    </div>

<script>
// Grid data: row, col, char, special(bool), clue#
const words = [
    {word: "LILY", r: 0, c: 0, dir: "A", clue: "A type of flower (Key)", special: true, n: 1},
    {word: "NEWARK", r: 0, c: 5, dir: "A", clue: "A major NJ airport", n: 4},
    {word: "FRUITLOOPS", r: 2, c: 0, dir: "A", clue: "Colorful breakfast cereal", n: 8},
    {word: "STAGE", r: 4, c: 0, dir: "A", clue: "Where actors perform", n: 10},
    {word: "LONDON", r: 4, c: 6, dir: "A", clue: "England's capital (Key)", special: true, n: 11},
    {word: "GIFT", r: 6, c: 0, dir: "A", clue: "Something given on a birthday", n: 13},
    {word: "PILOT", r: 6, c: 5, dir: "A", clue: "They fly the plane", n: 14},
    {word: "MARCH", r: 8, c: 0, dir: "A", clue: "The third month (Key)", special: true, n: 15},
    {word: "TENNIS", r: 10, c: 0, dir: "A", clue: "Sport played with a racket", n: 16},
    {word: "ELVES", r: 12, c: 0, dir: "A", clue: "Santa's helpers", n: 17},
    {word: "ALLENWRENCH", r: 0, c: 0, dir: "D", clue: "L-shaped tool (Key)", special: true, n: 2},
    {word: "TWENTYONE", r: 0, c: 10, dir: "D", clue: "Three times seven (Key)", special: true, n: 3},
    {word: "BRITISHAIRWAYS", r: 0, c: 12, dir: "D", clue: "Major UK airline", n: 5},
    {word: "FRIDAYNIGHT", r: 0, c: 14, dir: "D", clue: "Start of the weekend", n: 6},
    {word: "KITTYKATPALACE", r: 2, c: 2, dir: "D", clue: "A fancy home for a feline", n: 7},
    {word: "SLEEPWALKING", r: 2, c: 4, dir: "D", clue: "Moving while dreaming", n: 9},
    {word: "NONMONOGAMY", r: 4, c: 8, dir: "D", clue: "Relationship style", n: 12},
    {word: "RUMINATING", r: 5, c: 6, dir: "D", clue: "Thinking deeply or obsessively", n: 14},
    {word: "RELAPSE", r: 6, c: 0, dir: "D", clue: "A setback in recovery", n: 13},
    {word: "WESTEND", r: 8, c: 10, dir: "D", clue: "London's theater district", n: 18},
    {word: "EVENING", r: 8, c: 2, dir: "D", clue: "Time after sunset", n: 19},
    {word: "SONG", r: 11, c: 4, dir: "D", clue: "A musical composition", n: 20},
    {word: "MISTLETOE", r: 6, c: 14, dir: "D", clue: "Kiss underneath this", n: 21}
];

const gridSize = 15;
const gridData = Array(gridSize).fill().map(() => Array(gridSize).fill(null));
let currentDir = "A";

// Build Grid Model
words.forEach(w => {
    for (let i = 0; i < w.word.length; i++) {
        let r = w.dir === "A" ? w.r : w.r + i;
        let c = w.dir === "A" ? w.c + i : w.c;
        if (!gridData[r][c]) gridData[r][c] = { char: w.word[i], special: false, n: null, id: `cell-${r}-${c}` };
        if (w.special) gridData[r][c].special = true;
        if (i === 0) gridData[r][c].n = w.n;
    }
});

// Render Grid
const gridEl = document.getElementById('grid');
for (let r = 0; r < gridSize; r++) {
    for (let c = 0; c < gridSize; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell' + (gridData[r][c] ? '' : ' black') + (gridData[r][c]?.special ? ' special' : '');
        if (gridData[r][c]) {
            if (gridData[r][c].n) cell.innerHTML = `<span class="clue-number">${gridData[r][c].n}</span>`;
            const input = document.createElement('input');
            input.maxLength = 1;
            input.dataset.r = r;
            input.dataset.c = c;
            input.id = gridData[r][c].id;
            
            // Load progress
            const saved = localStorage.getItem(input.id);
            if (saved) {
                input.value = saved;
                validate(input);
            }

            input.addEventListener('input', (e) => handleInput(e));
            input.addEventListener('keydown', (e) => handleKey(e));
            input.addEventListener('click', (e) => {
                if (document.activeElement === input) {
                    currentDir = currentDir === "A" ? "D" : "A";
                }
            });
            cell.appendChild(input);
        }
        gridEl.appendChild(cell);
    }
}

function handleInput(e) {
    const input = e.target;
    input.value = input.value.toUpperCase();
    validate(input);
    localStorage.setItem(input.id, input.value);
    if (input.value) moveCursor(input, 1);
    checkWin();
}

function handleKey(e) {
    if (e.key === "Backspace" && !e.target.value) {
        moveCursor(e.target, -1);
    }
}

function validate(input) {
    const r = input.dataset.r;
    const c = input.dataset.c;
    if (!input.value) {
        input.parentElement.classList.remove('correct', 'wrong');
        return;
    }
    const isCorrect = input.value === gridData[r][c].char;
    input.parentElement.classList.toggle('correct', isCorrect);
    input.parentElement.classList.toggle('wrong', !isCorrect);
}

function moveCursor(input, step) {
    let r = parseInt(input.dataset.r);
    let c = parseInt(input.dataset.c);
    let next;
    if (currentDir === "A") c += step; else r += step;
    next = document.getElementById(`cell-${r}-${c}`);
    if (next) next.focus();
}

function checkWin() {
    const inputs = document.querySelectorAll('input');
    const allCorrect = Array.from(inputs).every(i => i.value === gridData[i.dataset.r][i.dataset.c].char);
    if (allCorrect) document.getElementById('win-message').style.display = 'block';
}

// Render Clues
const aClues = document.getElementById('across-clues');
const dClues = document.getElementById('down-clues');
words.sort((a,b) => a.n - b.n).forEach(w => {
    const item = document.createElement('div');
    item.className = 'clue-item';
    item.innerHTML = `<strong>${w.n}.</strong> ${w.clue}`;
    item.onclick = () => {
        currentDir = w.dir;
        document.getElementById(`cell-${w.r}-${w.c}`).focus();
    };
    (w.dir === "A" ? aClues : dClues).appendChild(item);
});
</script>
</body>
</html>
