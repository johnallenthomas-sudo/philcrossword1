<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Personal Crossword</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --cell-size: 55px;
            --correct-bg: #d4edda;
            --wrong-bg: #f8d7da;
            --selected-bg: #fff3cd;
            --special-border: #ff0000;
            --standard-border: #333;
        }

        body { font-family: -apple-system, sans-serif; background: #fdfdfd; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { display: flex; flex-direction: row; gap: 40px; max-width: 1300px; width: 100%; justify-content: center; }
        
        @media (max-width: 1000px) {
            .container { flex-direction: column; align-items: center; }
            :root { --cell-size: 8.5vw; }
        }

        .grid-container { position: relative; }
        .grid { display: grid; grid-template-columns: repeat(11, var(--cell-size)); grid-template-rows: repeat(8, var(--cell-size)); background: #000; border: 4px solid #000; }
        
        .cell { width: var(--cell-size); height: var(--cell-size); background: white; position: relative; border: 1px solid var(--standard-border); box-sizing: border-box; }
        .cell.black { background: #000; border: none; }
        .cell.special-word { border: 2.5px solid var(--special-border); z-index: 5; }
        
        .cell input { width: 100%; height: 100%; border: none; text-align: center; font-size: 1.4rem; font-weight: bold; text-transform: uppercase; background: transparent; cursor: pointer; caret-color: transparent; }
        .cell input:focus { outline: none; background: var(--selected-bg); }
        .cell.correct { background-color: var(--correct-bg) !important; }
        .cell.wrong { background-color: var(--wrong-bg) !important; }

        .cell-num { position: absolute; top: 2px; left: 3px; font-size: 0.7rem; font-weight: bold; color: #000; pointer-events: none; z-index: 10; }

        .clues-section { flex: 1; display: flex; flex-direction: column; gap: 20px; max-width: 450px; height: 80vh; overflow-y: auto; padding-right: 10px; }
        .clue-group { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .clue-item { margin-bottom: 12px; cursor: pointer; font-size: 0.95rem; line-height: 1.4; padding: 4px; border-radius: 4px; }
        .clue-item.special { color: var(--special-border); font-weight: bold; }
        .clue-item:hover { background: #f0f7ff; }

        .win-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .win-modal { background: white; padding: 40px; border-radius: 20px; text-align: center; }
        button { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-top: 15px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    const CLUES_DATA = {
        across: [
            { id: 1, r: 0, c: 1, ans: "LONDON", isSpecial: true, clue: "1: They say home is where the heart is, but that's not where his lived." },
            { id: 3, r: 0, c: 5, ans: "MARCH", isSpecial: true, clue: "3: Beware the ides" },
            { id: 2, r: 1, c: 0, ans: "RELAPSE", isSpecial: false, clue: "2: Your mother commonly did this when you were a child (unfortunately)" },
            { id: 3, r: 2, c: 0, ans: "BRITISHAIRWAYS", isSpecial: false, clue: "3 (Row 3): \"To fly. To serve.\"" },
            { id: 8, r: 2, c: 3, ans: "ALLENWRENCH", isSpecial: true, clue: "8: An L-shaped tool you're shocked I own" },
            { id: 6, r: 3, c: 0, ans: "FRIDAYNIGHT", isSpecial: false, clue: "6: Our equivalent of Saturday night in Tel Aviv" },
            { id: 7, r: 3, c: 2, ans: "KITTYKATPALACE", isSpecial: false, clue: "7: What probably comes to mind when you're stuck on the F line" },
            { id: 10, r: 3, c: 7, ans: "RUMINATING", isSpecial: false, clue: "10: What a fucking line" },
            { id: 8, r: 4, c: 0, ans: "TENNIS", isSpecial: false, clue: "8 (Row 5): Daddy's home for the first time in weeks..." },
            { id: 12, r: 4, c: 6, ans: "EVENING", isSpecial: false, clue: "12: That time of day betwen the afternoon and the night. Don't overthink it." },
            { id: 10, r: 5, c: 3, ans: "SLEEPWALKING", isSpecial: false, clue: "10 (Row 6): Romance isn't dead?" },
            { id: 14, r: 5, c: 8, ans: "STAGE", isSpecial: false, clue: "14: Shakespeare said the entire world was one of these" },
            { id: 11, r: 6, c: 0, ans: "NONMONOGAMY", isSpecial: false, clue: "11: People pleasing, perhaps?" },
            { id: 12, r: 6, c: 7, ans: "SONG", isSpecial: false, clue: "12 (Row 7): A general way to describe the answer to a handful of clues in this puzzle" },
            { id: 15, r: 7, c: 0, ans: "TWENTYONE", isSpecial: true, clue: "15: The sum of eleven and ten; a significant age." }
        ],
        down: [
            { id: 1, r: 0, c: 1, ans: "LILY", isSpecial: true, clue: "1: After my white dad died people gave us many of these [also in white] to express their sympathy (singular)" },
            { id: 3, r: 0, c: 3, ans: "ALLEN", isSpecial: true, clue: "3: An L-shaped tool you're shocked I own" },
            { id: 3, r: 0, c: 5, ans: "FRUITLOOPS", isSpecial: false, clue: "3 (Col 6): Many a 90s child favorite sugary breakfast" },
            { id: 4, r: 0, c: 8, ans: "NEWARK", isSpecial: false, clue: "4: Confused with New York Penn Station on the NE Cooridor when pronounced too quickly" },
            { id: 11, r: 1, c: 10, ans: "WESTEND", isSpecial: false, clue: "11: You're deranged?" },
            { id: 14, r: 2, c: 9, ans: "MISTLETOE", isSpecial: false, clue: "14: If you looked up and it was there, we'd for sure makeout" },
            { id: 13, r: 4, c: 4, ans: "GIFT", isSpecial: false, clue: "13: That pillow you found under the christmas tree recently" },
            { id: 10, r: 7, c: 6, ans: "PILOT", isSpecial: false, clue: "10: The person you should actually tell to \"have a safe flight\"" },
            { id: 15, r: 7, c: 9, ans: "ELVES", isSpecial: false, clue: "15: Tiny little lads in the north pole" }
        ]
    };

    const GRID_TEMPLATE = [
        ['#', '1', ' ', '3', '#', '3', ' ', '#', '4', '#', '#'],
        ['2', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '11'],
        ['3', ' ', '#', '8', ' ', ' ', ' ', ' ', '#', '14', ' '],
        ['6', '#', '7', ' ', '#', ' ', '#', '10', ' ', ' ', ' '],
        ['8', ' ', ' ', '#', '13', '#', '12', ' ', '#', '#', ' '],
        ['#', ' ', '#', '10', ' ', ' ', ' ', '#', '14', ' ', ' '],
        ['11', ' ', ' ', ' ', ' ', ' ', '#', '12', ' ', ' ', '#'],
        ['15', '#', ' ', ' ', ' ', '#', '10', ' ', '#', '15', '#']
    ];

    const Crossword = () => {
        const [grid, setGrid] = useState(() => {
            const saved = localStorage.getItem('puzzle_save');
            return saved ? JSON.parse(saved) : Array(8).fill().map(() => Array(11).fill(''));
        });
        const [dir, setDir] = useState('A');

        const solutionGrid = Array(8).fill().map(() => Array(11).fill(null));
        [...CLUES_DATA.across, ...CLUES_DATA.down].forEach(w => {
            for (let i = 0; i < w.ans.length; i++) {
                let r = w.r + (CLUES_DATA.down.includes(w) ? i : 0);
                let c = w.c + (CLUES_DATA.across.includes(w) ? i : 0);
                if (r < 8 && c < 11) solutionGrid[r][c] = w.ans[i];
            }
        });

        useEffect(() => {
            localStorage.setItem('puzzle_save', JSON.stringify(grid));
            const isFinished = solutionGrid.every((row, r) => row.every((char, c) => !char || grid[r][c] === char));
            if (isFinished && grid.flat().join('').length > 50) setWin(true);
        }, [grid]);

        const [win, setWin] = useState(false);

        const isSpecialCell = (r, c) => {
            return [...CLUES_DATA.across, ...CLUES_DATA.down].some(w => {
                if (!w.isSpecial) return false;
                const isAcross = CLUES_DATA.across.includes(w);
                if (isAcross) return r === w.r && c >= w.c && c < w.c + w.ans.length;
                return c === w.c && r >= w.r && r < w.r + w.ans.length;
            });
        };

        const handleInput = (r, c, val) => {
            const newGrid = [...grid];
            const char = val.slice(-1).toUpperCase();
            newGrid[r][c] = char;
            setGrid(newGrid);

            if (char) {
                const next = document.querySelector(`input[data-p="${dir === 'A' ? r + '-' + (c + 1) : (r + 1) + '-' + c}"]`);
                if (next) next.focus();
            }
        };

        return (
            <div className="container">
                {win && <div className="win-overlay"><div className="win-modal"><h2>You Won! ðŸŽ‰</h2><button onClick={() => setWin(false)}>Close</button></div></div>}
                <div className="grid-container">
                    <div className="grid">
                        {GRID_TEMPLATE.map((row, r) => row.map((num, c) => {
                            const isBlack = num === '#';
                            const special = isSpecialCell(r, c);
                            const correct = grid[r][c] && grid[r][c] === solutionGrid[r][c];
                            const wrong = grid[r][c] && grid[r][c] !== solutionGrid[r][c];
                            return (
                                <div key={`${r}-${c}`} className={`cell ${isBlack ? 'black' : ''} ${special ? 'special-word' : ''} ${correct ? 'correct' : ''} ${wrong ? 'wrong' : ''}`}>
                                    {!isBlack && (
                                        <>
                                            {parseInt(num) > 0 && <span className="cell-num">{num}</span>}
                                            <input 
                                                data-p={`${r}-${c}`}
                                                value={grid[r][c]} 
                                                onClick={() => setDir(dir === 'A' ? 'D' : 'A')}
                                                onChange={(e) => handleInput(r, c, e.target.value)} 
                                            />
                                        </>
                                    )}
                                </div>
                            );
                        }))}
                    </div>
                </div>
                <div className="clues-section">
                    <div className="clue-group">
                        <h3>Across (Up Orientation)</h3>
                        {CLUES_DATA.across.map(clue => (
                            <div key={clue.ans + clue.r} className={`clue-item ${clue.isSpecial ? 'special' : ''}`} onClick={() => setDir('A')}>
                                {clue.clue}
                            </div>
                        ))}
                    </div>
                    <div className="clue-group">
                        <h3>Down</h3>
                        {CLUES_DATA.down.map(clue => (
                            <div key={clue.ans + clue.r} className={`clue-item ${clue.isSpecial ? 'special' : ''}`} onClick={() => setDir('D')}>
                                {clue.clue}
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Crossword />);
</script>
</body>
</html>
